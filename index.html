<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Iverse</title>
  <link rel="stylesheet" href="styles/base.css" />
</head>
<body>
  <header id="app-header" class="hidden">
    <h1>Iverse</h1>
    <nav>
      <button class="nav-btn" data-target="view-home" type="button">マイページ</button>
      <button class="nav-btn" data-target="view-ai" type="button">AIおすすめ</button>
      <button class="nav-btn" data-target="view-chat" type="button">メッセージ</button>
      <button id="btn-logout" class="outline" type="button">ログアウト</button>
    </nav>
  </header>

  <main>
    <!-- ログイン（そのまま保持） -->
    <section id="view-login" class="view">
      <div class="login-wrap">
        <h2>ログイン</h2>
        <div class="card">
          <input id="login-name" type="text" placeholder="ユーザー名" autocomplete="username" />
          <input id="login-pass" type="password" placeholder="パスワード" autocomplete="current-password" />
          <button id="login-btn" type="button">ログイン</button>
        </div>
      </div>
    </section>

    <!-- 以下はインクルードで読み込み -->
    <div data-include="views/home.html" data-css="styles/home.css"></div>
    <div data-include="views/ai.html" data-css="styles/ai.css"></div>
    <div data-include="views/chat.html" data-css="styles/chat.css"></div>
  </main>

  <!-- プロフィール詳細モーダル（インクルード） -->
  <div data-include="views/profile-modal.html" data-css="styles/modal.css"></div>

  <footer class="app-footer">© 2025 Iverse </footer>

  <!-- 断片インクルードローダー（挿入完了後にアプリを起動） -->
  <script>
    (function(){
      function ensureCss(url){
        if (!url) return;
        const exists = Array.from(document.querySelectorAll('link[rel="stylesheet"]')).some(l => l.getAttribute('href') === url);
        if (!exists){
          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = url;
          document.head.appendChild(link);
        }
      }

      const containers = Array.from(document.querySelectorAll('[data-include]'));
      if (containers.length === 0) return startApp();
      let loaded = 0;
      containers.forEach(async (el)=>{
        const cssAttr = el.getAttribute('data-css');
        if (cssAttr){ cssAttr.split(',').map(s=>s.trim()).forEach(ensureCss); }

        const url = el.getAttribute('data-include');
        try{
          const res = await fetch(url, { cache: 'no-cache' });
          const html = await res.text();
          el.outerHTML = html;
        }catch(e){
          console.error('include failed:', url, e);
        }finally{
          loaded++;
          if (loaded === containers.length) startApp();
        }
      });
      function startApp(){
        const s = document.createElement('script');
        s.type = 'module';
        s.src = 'scripts/app.js';
        document.body.appendChild(s);
      }
    })();
  </script>
</body>
</html>
